[dekERPVIS]
Orders_Details=SELECT DISTINCT item.pline_no 產線代號, cust.custnm2 客戶簡稱 , mkordsub.item_no CCS, mkordsub.lot_no 製造批號, cordsub.sclose 訂單狀況 ,  EMPLOY.Name 業務員,DATE_FORMAT(cordsub.d_date, '%Y/%m/%d') 預交日,date_format(mkordsub.str_date, '%Y/%m/%d') 預計開工日,{4}INVOSUB.TRN_DATE 出貨日,cordsub.quantity 數量,cordsub.amount 金額,    (CASE WHEN SUBSTRING(DATE_FORMAT(cordsub.d_date, '%Y%m%d'), 7,  2) <= 25 THEN DATE_FORMAT(cordsub.d_date, '%Y%m') WHEN SUBSTRING(DATE_FORMAT(cordsub.d_date, '%Y%m%d'), 7, 2) >= 25 THEN CASE WHEN SUBSTRING(DATE_FORMAT(cordsub.d_date, '%Y%m%d'), 5,  2) = 12 THEN  CONCAT(SUBSTRING(DATE_FORMAT(cordsub.d_date, '%Y%m%d'), 1,  4) + 1, '01') ELSE SUBSTRING(DATE_FORMAT(cordsub.d_date, '%Y%m%d'), 1, 6) + 1 END END) 計算月份 FROM cordsub AS cordsub LEFT JOIN item ON cordsub.ITEM_NO = item.ITEM_NO LEFT JOIN ws ON cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn LEFT JOIN mkordsub AS mkordsub ON cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn LEFT JOIN cust AS cust ON cust.cust_no = cordsub.cust_no LEFT JOIN cord AS cord ON cord.trn_no = cordsub.trn_no LEFT JOIN INVOSUB ON cordsub.TRN_NO=INVOSUB.CORD_NO AND cordsub.SN=INVOSUB.CORD_SN LEFT JOIN EMPLOY ON EMPLOY.EMP_NO = CORD.USER_CODE {3} WHERE   item.pline_no > 0        AND (CASE        WHEN INVOSUB.TRN_DATE THEN DATE_FORMAT(cordsub.d_date, '%Y%m%d')        WHEN DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d') <= DATE_FORMAT(cordsub.d_date, '%Y%m%d') THEN DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d')        ELSE DATE_FORMAT(cordsub.d_date, '%Y%m%d')    END) >= {0}        AND (CASE WHEN INVOSUB.TRN_DATE THEN DATE_FORMAT(cordsub.d_date, '%Y%m%d') WHEN DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d') <= DATE_FORMAT(cordsub.d_date, '%Y%m%d') THEN DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d') ELSE DATE_FORMAT(cordsub.d_date, '%Y%m%d') END) <= {1}        AND cordsub.price > 0 {2} order by cordsub.d_date asc
Orders_Over_Detail= SELECT DISTINCT item.pline_no AS 產線代號, cust.custnm2 AS 客戶簡稱, mkordsub.item_no AS CCS, mkordsub.lot_no AS 製造批號, cordsub.sclose AS 訂單狀況 , EMPLOY.Name 業務員, DATE_FORMAT(cordsub.d_date, '%Y/%m/%d') 預交日,date_format(mkordsub.str_date, '%Y/%m/%d') AS 預計開工日,{2}INVOSUB.TRN_DATE 出貨日,cordsub.quantity AS 數量,cordsub.amount 金額 FROM cordsub AS cordsub LEFT JOIN item ON cordsub.ITEM_NO = item.ITEM_NO LEFT JOIN ws ON cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn LEFT JOIN mkordsub AS mkordsub ON cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn LEFT JOIN cust AS cust ON cust.cust_no = cordsub.cust_no LEFT JOIN cord AS cord ON cord.trn_no = cordsub.trn_no LEFT JOIN INVOSUB ON cordsub.TRN_NO=INVOSUB.CORD_NO AND cordsub.SN=INVOSUB.CORD_SN LEFT JOIN EMPLOY ON EMPLOY.EMP_NO = CORD.USER_CODE {1} WHERE item.pline_no > 0 AND DATE_FORMAT(cordsub.d_date, '%Y%m%d') <{0} AND (cordsub.sclose <> '結案' OR DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d') >= {0}) AND cordsub.amount > 0
Shipment_Detail= SELECT item.pline_no AS 產線代號,cust.custnm2 AS 客戶簡稱, invosub.item_no AS 品號,invosub.item_nm AS 品名規格, invosub.quantity AS 小計 FROM invosub LEFT JOIN cust AS cust ON cust.cust_no = invosub.cust_no LEFT JOIN cordsub AS cordsub ON cordsub.trn_no = invosub.cord_no AND cordsub.sn = invosub.cord_sn LEFT JOIN item AS item ON invosub.item_no = item.item_no WHERE item.pline_no > 0 AND date_format(invosub.trn_date, '%Y%m%d') >= {0} AND date_format(invosub.trn_date, '%Y%m%d') <= {1} AND item.class >= 'Z' AND item.class <= 'ZR'
Get_Shipment=SELECT DISTINCT invosub.trn_date AS 出貨日期, invosub.trn_no AS 出貨單號, mkordsub.lot_no AS 製造批號, mkordsub.item_no AS CCS,invosub.QUANTITY 數量, cordsub.remark AS 訂單備註 FROM invosub LEFT JOIN cust AS cust ON cust.cust_no = invosub.cust_no LEFT JOIN cordsub AS cordsub ON cordsub.trn_no = invosub.cord_no AND cordsub.sn = invosub.cord_sn LEFT JOIN mkordsub AS mkordsub ON cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn LEFT JOIN item AS item ON invosub.item_no = item.item_no WHERE date_format(invosub.trn_date, '%Y%m%d') >= {0} AND date_format(invosub.trn_date, '%Y%m%d') <= {1} AND item.class >= 'Z' AND item.class <= 'ZR' AND cust.custnm2 = '{2}' AND invosub.item_no = '{3}' ORDER  BY invosub.trn_date DESC
UntradedCustomer= SELECT * FROM (SELECT cust.custnm2 AS 客戶簡稱, DATE_FORMAT( Max(trn_date) , "%Y/%m/%d" ) AS 最後交易日, DATEDIFF('{3}', Max(trn_date)) AS 未交易天數 FROM cord LEFT JOIN cust AS cust ON cust.cust_no = cord.cust_no WHERE cust.custnm2 IS NOT NULL GROUP BY cust.custnm2) AS A where 未交易天數 {0} {1} {2}  
Supplierscore_Detail= select a.* , cast(((cast(a.期限內已交數量 AS decimal(17, 0))) / cast(a.採購數量 AS decimal(17, 0))*100) AS decimal(17, 2)) AS 達交率 from ( SELECT fact.factnm2 AS 供應商, sord.trn_no AS 採購單號, sordsub.sn AS 採購明細序,   sordsub.item_no AS 品號,  sordsub.ITEMNM AS 品名規格,  cast(sordsub.quantity AS decimal(17, 0)) AS 採購數量,  sum(cast(purcsub.q_delied AS decimal(17, 0))) AS 期限內已交數量, date_format(sord.trn_date, '%Y/%m/%d') AS 採購單日期,  date_format(sordsub.d1, '%Y/%m/%d') AS 預交日期,  max(date_format(purcsub.trn_date, '%Y/%m/%d')) AS 期限內最後進貨日期 FROM sord LEFT JOIN sordsub ON sord.trn_no = sordsub.trn_no LEFT JOIN purcsub ON purcsub.sord_no = sord.trn_no LEFT JOIN fact ON fact.fact_no = sord.fact_no WHERE date_format(sordsub.d1, '%Y%m%d') >= {0} AND date_format(sordsub.d1, '%Y%m%d') <= {1} AND purcsub.sord_sn = sordsub.sn AND sordsub.d1 >= purcsub.trn_date group by sord.trn_no, sordsub.sn , fact.factnm2, sordsub.item_no, sordsub.ITEMNM,sordsub.quantity,sord.trn_date, sordsub.d1 ) a
materialrequirementplanning_Detail= SELECT itemios.trn_no AS 領料單號,   itemios.trn_date AS 領料單日期, itemios.item_no AS 領料單明細品號, item.itemnm AS 領料單明細品名規格, itemios.qty2 AS 領料數量, IFNULL(itemios.s_desc,'未知用途') AS 用途說明, itemios.mkord_no AS 製令單號, (SELECT mkordsub.item_no FROM mkordsub WHERE itemios.mkord_no = mkordsub.trn_no ORDER BY mkordsub.item_no DESC LIMIT 1) AS 製令明細品號, (SELECT item.itemnm FROM item WHERE item.item_no = (SELECT mkordsub.item_no FROM mkordsub WHERE itemios.mkord_no = mkordsub.trn_no ORDER BY mkordsub.item_no DESC LIMIT 1)) AS 製令明細品名規格, IFNULL(cust.custnm2,'未填寫') AS 使用客戶 FROM itemios LEFT JOIN item AS item ON itemios.item_no = item.item_no LEFT JOIN cust AS CUST ON itemios.cust_no = cust.cust_no WHERE  DATE_FORMAT(trn_date, '%Y%m%d') >= {0} AND DATE_FORMAT(trn_date, '%Y%m%d') <={1} AND itemios.qty2 > 0 {2} ORDER  BY itemios.trn_date
pick_list_datatable= select itemios.item_no as 品號 ,(select itemnm from item where item.item_no=itemios.item_no) as 品名規格 ,'' as 倉位 ,itemios.unit as 單位 ,itemios.PQTY_H as 現有庫存 ,itemios.QTY1 as 申請數量 ,itemios.QTY2 as 領料數量 ,(itemios.QTY1-itemios.QTY2) as 不足數量 ,     (SELECT SCLOSE FROM mkordis WHERE mkordis.trn_no=itemios.mkord_no AND mkordis.item_no=itemios.item_no) 狀況,IFnull(itemio.LOT_NO,itemio.mkord_no) 刀庫或製令 from itemios LEFT JOIN itemio ON itemios.trn_no = itemio.trn_no where itemios.IOtype in ('1','2') {0};
pick_list_title= SELECT  itemio.trn_no AS 領料單號, DATE_FORMAT(itemio.trn_date, '%Y%m%d')  AS 領料日期, (SELECT  name  FROM employ WHERE itemio.user_code = employ.emp_no) AS 領料人, itemio.mkord_no AS 製令單號, (SELECT  cord_no FROM mkord WHERE mkord.trn_no = itemio.mkord_no) AS 訂單號碼, itemio.s_desc AS 用途說明, (SELECT  name FROM employ WHERE ITEMIO.STOCK = employ.emp_no) AS 倉管, itemio.LOT_NO AS 製造批號, (SELECT  CUST.CUSTNM2 FROM CUST WHERE CUST.cust_no = (SELECT  cust_no FROM mkord WHERE mkord.trn_no = itemio.mkord_no)) AS 客戶簡稱, '' AS 產品組件, '0.00' AS 領料台數 FROM itemio WHERE itemio.IOtype IN ('1' , '2') {0}
Inventory_Total_Amount= SELECT item.item_no AS 品號,itemnm AS 品名規格,class.CLASS_NAME AS 物料類別, case item.NOUSE when 'Y' then '是' else  '' end 是否停用, ITEM_GD.GDNO AS 倉位,ITEM_GD.qty AS 庫存數量,SCOST AS 庫存金額,(ITEM_GD.qty*SCOST) AS 總庫存金額 FROM item LEFT JOIN ITEM_GD ON ITEM_GD.ITEM_NO = ITEM.ITEM_NO AND ITEM_GD.QTY >0 LEFT JOIN CLASS ON CLASS.CLASS_NO = ITEM.CLASS WHERE PQTY_H>0 {0} {1} ORDER BY item.item_no
InactiveInventory= SELECT b.儲位,IFNULL(b.最後領料日, '---')  最後領料日, a.品號, b.品名規格, b.倉位, b.類別,a.庫存數量 剩餘總庫存, a.領用數量, a.銷貨數量, a.入庫數量,(a.庫存數量 + a.領用數量 + a.銷貨數量) 期初庫存, ((a.領用數量 + a.銷貨數量) / (a.庫存數量 + a.領用數量 + a.銷貨數量 - a.入庫數量))  領用比例, b.標準成本, b.標準成本 * a.庫存數量 金額小計 FROM (SELECT item.item_no 品號, IFNULL(ITEM.PQTY_H, 0) 庫存數量, IFNULL(a.領用數量, 0) 領用數量, IFNULL(b.入庫數量, 0) 入庫數量, IFNULL(c.銷貨數量, 0) 銷貨數量 FROM item LEFT JOIN ITEM_GD ON ITEM_GD.ITEM_NO = ITEM.ITEM_NO LEFT JOIN (SELECT itemios.item_no 品號, SUM(ITEMIOS.QTY2) 領用數量 FROM itemios LEFT JOIN item ON itemios.item_no = item.item_no WHERE itemios.IOTYPE = 1 AND DATE_FORMAT(itemios.trn_date, '%Y%m%d') > {0} AND DATE_FORMAT(itemios.trn_date, '%Y%m%d') < {1} GROUP BY itemios.item_no) a ON a.品號 = item.item_no LEFT JOIN (SELECT itemios.item_no 品號, SUM(ITEMIOS.QTY2) 入庫數量 FROM itemios LEFT JOIN item ON itemios.item_no = item.item_no WHERE itemios.IOTYPE = 2 AND DATE_FORMAT(itemios.trn_date, '%Y%m%d') > {0} AND DATE_FORMAT(itemios.trn_date, '%Y%m%d') <  {1} GROUP BY itemios.item_no) b ON b.品號 = item.item_no LEFT JOIN (SELECT invosub.item_no 品號, SUM(invosub.QUANTITY) 銷貨數量 FROM invosub LEFT JOIN item ON invosub.item_no = item.item_no WHERE TYPE = 1 AND DATE_FORMAT(invosub.trn_date, '%Y%m%d') > {0} AND DATE_FORMAT(invosub.trn_date, '%Y%m%d') <  {1} GROUP BY invosub.item_no) c ON c.品號 = item.item_no WHERE ITEM.PQTY_H > 0 {2} AND ITEM.COQTY = 0 AND ITEM.ISQTY = 0 AND ITEM.SMQTY >= 0 AND ITEM.SOQTY >= 0 AND ITEM_GD.QTY > 0 {3} ) a LEFT JOIN  (SELECT DISTINCT ITEM.item_no  品號, ITEM.ITEMNM  品名規格, ITEM.PQTY_H  庫存數, ITEM.PLACE  倉位, DATE_FORMAT( MAX(itemios.trn_date) , "%Y%m%d" )   最後領料日, ITEM_GD.GDNO  儲位, ITEM.SCOST  標準成本, class.CLASS_NAME  類別 FROM ITEM LEFT JOIN itemios ON itemios.ITEM_NO = ITEM.ITEM_NO LEFT JOIN ITEM_GD ON ITEM_GD.ITEM_NO = ITEM.ITEM_NO LEFT JOIN CLASS ON CLASS.CLASS_NO = ITEM.CLASS WHERE ITEM_GD.QTY > 0 {2} {3} GROUP BY ITEM.ITEM_NO, ITEM.ITEMNM, ITEM.PQTY_H, ITEM.PLACE, ITEM_GD.GDNO, ITEM.SCOST, class.CLASS_NAME)  b ON a.品號 = b.品號 AND a.庫存數量 = b.庫存數 ORDER BY 儲位 DESC
Scrapped= SELECT itemio.stockname AS 報廢者, itemios.trn_no AS 單據號碼,  DATE_FORMAT(itemios.trn_date, '%Y%m%d') AS 單據日期, item.item_no AS 品號, item.itemnm AS 品名規格, item.unit AS 單位, item.scost AS 標準成本, itemios.QTY2 AS 報廢數量, (item.scost * itemios.QTY2) AS 金額小計, itemio.remark AS 備註 FROM item AS ITEM LEFT JOIN itemios AS ITEMIOS ON item.item_no = itemios.item_no AND itemios.iotype = '7' LEFT JOIN itemio AS ITEMIO ON itemios.iotype = itemio.iotype AND itemios.trn_no = itemio.trn_no WHERE itemios.QTY2 <> 0 AND itemios.wastes_sw2 = 'Y' AND date_format(itemios.trn_date, '%Y%m%d') >={0} AND date_format(itemios.trn_date, '%Y%m%d') <= {1} {2}  ORDER BY 金額小計 DESC
stockanalysis_details= SELECT  cust.custnm2  客戶簡稱, item.pline_no  產線代號, mkordsub.lot_no  製造批號, itemios.trn_date  入庫日, DATEDIFF(now(), DATE_FORMAT(itemios.trn_date, '%Y%m%d')) 庫存天數, item.scost 庫存金額, ws.user_field08  庫存原因 FROM mkordsub LEFT JOIN itemios AS itemios ON itemios.mkord_no = mkordsub.trn_no AND itemios.mkord_sn = mkordsub.sn AND itemios.iotype = '3' LEFT JOIN cordsub AS cordsub ON cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn LEFT JOIN cust AS cust ON cust.cust_no = mkordsub.cust_no LEFT JOIN item AS item ON mkordsub.item_no = item.item_no LEFT JOIN ws AS ws ON ws.cord_no = cordsub.trn_no AND ws.cord_sn = cordsub.sn WHERE cordsub.sclose != '結案' AND mkordsub.sclose = '結案' AND itemios.trn_date != '' and item.pline_no>0
Transportrackstatistics= SELECT a.客戶簡稱,a.運輸架品號,IFNULL(sum(a.數量), 0) 正常數量 ,IFNULL(sum(b.數量), 0) 異常數量 FROM (SELECT cust.custnm2 AS 客戶簡稱,INVOSUB.ITEM_NO AS 運輸架品號,sum(INVOSUB.QUANTITY) AS 數量 FROM INVOSUB LEFT JOIN CUST AS cust ON cust.CUST_NO=INVOSUB.cust_no WHERE INVOSUB.CORD_NO='' {0} GROUP BY cust.custnm2, INVOSUB.ITEM_NO) a LEFT JOIN (SELECT cust.custnm2 AS 客戶簡稱,INVOSUB.ITEM_NO AS 運輸架品號,sum(INVOSUB.QUANTITY) AS 數量 FROM INVOSUB LEFT JOIN CUST AS cust ON cust.CUST_NO=INVOSUB.cust_no WHERE INVOSUB.CORD_NO='' {0} GROUP BY cust.custnm2, INVOSUB.ITEM_NO HAVING SUM(INVOSUB.QUANTITY) < 0) b ON a.客戶簡稱 = b.客戶簡稱 AND a.運輸架品號 = b.運輸架品號 WHERE a.數量>0  GROUP BY a.客戶簡稱,a.運輸架品號
SupplierShortage_Urge= SELECT urge_item.TRN_NO 催料單號, urge_item.ORIGIN_TRN_NO '採購/加工單', date_format(IFNULL(so.TRN_DATE,Sord.TRN_DATE), '%Y%m%d') 開單日期,urge_item.FACT_NO 廠商代碼,fact.FACTNM2 廠商簡稱,urge_item.item_no 品號,urge_item.itemnm 品名規格, date_format(urge_item.D_DATE, '%Y%m%d') 催料預交日, CAST(urge_item.quantity AS signed) 催料數量,'' 未交量,SOITEM_NO 加工代號 FROM urge_item LEFT JOIN fact ON urge_item.FACT_NO = fact.FACT_NO left join so on urge_item.ORIGIN_TRN_NO = so.TRN_NO left join sord on  urge_item.ORIGIN_TRN_NO = sord.Trn_no WHERE urge_item.TRN_NO = '{0}' {1} {2} {3} {4} ORDER BY urge_item.FACT_NO ASC, urge_item.item_no ASC
SupplierShortage_Delivery= SELECT  * FROM (SELECT  * FROM (SELECT  SO_NO 單號, Fact_no 廠商代碼, item_no 品號, CAST(PAY_QTY AS SIGNED) 收貨量, SOITEM_NO 加工代號, date_format(TRN_DATE, '%Y%m%d')  交易日期 FROM sopurcs) a UNION SELECT  *   FROM (SELECT  SORD_NO 採購單號, Fact_no 採購廠商代碼, item_no 採購品號, CAST(SORD_QUANTITY AS SIGNED) 採購繳交量, '' 加工代號, date_format(TRN_DATE, '%Y%m%d')  交易日期 FROM purcsub) b) x {0} ORDER BY 廠商代碼 ASC , 品號 ASC
Lost_Material=  SELECT      cust.CUSTNM2 客戶名稱,      DATE_FORMAT(analytics_pqty_h.STR_DATE, '%Y%m%d') 預計開工日,        analytics_pqty_h.LOT_NO 刀庫編號,     analytics_pqty_h.Item_no 品號,     analytics_pqty_h.ITEMNM 品名規格,     CAST(ABS(analytics_pqty_h.Q_DELIED) AS SIGNED) 欠缺數量,     analytics_pqty_h.FactNM 供應商名稱 , DATE_FORMAT(cord.TRN_DATE, '%Y%m%d') 下單日 FROM     analytics_pqty_h,     cord,     cust WHERE     analytics_pqty_h.CORD_NO = cord.TRN_NO         AND cust.CUST_NO = cord.CUST_NO         AND DATE_FORMAT(analytics_pqty_h.STR_DATE, '%Y%m%d') IS NOT NULL       and {0} <= DATE_FORMAT(analytics_pqty_h.STR_DATE, '%Y%m%d') and DATE_FORMAT(analytics_pqty_h.STR_DATE, '%Y%m%d')<={1} ORDER BY 預計開工日 
Orders_StartDay= SELECT DISTINCT item.pline_no 產線代號, cust.custnm2 客戶簡稱, mkordsub.lot_no 製造批號,mkordsub.item_no CCS, DATE_FORMAT(mkordsub.str_date, '%Y%m%d') 預計開工日,ws.user_field10 預計完工日, (CASE WHEN SUBSTRING(DATE_FORMAT(mkordsub.str_date, '%Y%m%d'), 7, 2) <= 25 THEN DATE_FORMAT(mkordsub.str_date, '%Y%m') WHEN SUBSTRING(DATE_FORMAT(mkordsub.str_date, '%Y%m%d'), 7, 2) >= 25 THEN CASE WHEN SUBSTRING(DATE_FORMAT(mkordsub.str_date, '%Y%m%d'), 5, 2) = 12 THEN CONCAT(SUBSTRING(DATE_FORMAT(mkordsub.str_date, '%Y%m%d'), 1, 4) + 1, '01') ELSE SUBSTRING(DATE_FORMAT(mkordsub.str_date, '%Y%m%d'), 1, 6) + 1 END END) 計算月份 FROM cordsub, item, ws, mkordsub, cust WHERE cordsub.ITEM_NO = item.ITEM_NO AND cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn AND cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn AND cust.cust_no = cordsub.cust_no AND mkordsub.str_date IS NOT NULL AND mkordsub.lot_no IS NOT NULL and  mkordsub.SCLOSE <> '結案' and (mkordsub.FCLOSE <> '1' or mkordsub.FCLOSE IS NULL  ) AND {0} <= DATE_FORMAT(mkordsub.str_date, '%Y%m%d') AND DATE_FORMAT(mkordsub.str_date, '%Y%m%d') <= {1} ORDER  BY 預計開工日,產線代號 ASC 
KnifeSet=SELECT  a.排程編號, a.品號, b.母件品名, a.子件品號, a.子件品名, a.預計開工日, a.類別, a.位置, a.需求量 FROM (SELECT DISTINCT mkordsub.LOT_NO 排程編號, mkordsub.ITEM_NO 品號, DATE_FORMAT(mkordsub.str_date, '%Y%m%d') 預計開工日, item.ITEM_NO 子件品號, item.ITEMNM 子件品名, class.CLASS_NAME 類別, item.PLACE 位置, mkordis.TQTY 需求量 FROM mkordsub, mkordis, item, class WHERE mkordsub.LOT_NO = mkordis.LOT_NO AND mkordis.ITEM_NO = item.ITEM_NO AND item.class = CLASS.CLASS_NO AND {0} <= DATE_FORMAT(mkordsub.str_date, '%Y%m%d') AND DATE_FORMAT(mkordsub.str_date, '%Y%m%d') <= {1} AND (mkordsub.SCLOSE <> '結案' OR mkordsub.SCLOSE IS NULL) AND (mkordis.SCLOSE <> '結案' OR mkordis.SCLOSE IS NULL) AND class.CLASS_NAME LIKE '%刀套%') a LEFT JOIN (SELECT DISTINCT CCS, a.母件品號, a.母件品名, b.子件品號, b.子件品名 FROM (SELECT  BOM_NO CCS, BOMS_NO 母件品號, item.ITEMNM 母件品名 FROM BOMsub, item WHERE item.ITEM_NO = BOMSUB.BOMS_NO AND SUBSTRING(item.ITEM_NO, 1, 1) = 'p' AND (SUBSTRING(item.ITEM_NO, 5, 1) = '-' OR SUBSTRING(item.ITEM_NO, 4, 1) = '-') AND ((LENGTH(item.ITEM_NO) - LENGTH(REPLACE(item.ITEM_NO, '-', ''))) / LENGTH('-')) = 2) a LEFT JOIN (SELECT  BOMsub.BOM_NO 母件品號, boms_no 子件品號, item.ITEMNM 子件品名 FROM BOMsub, item WHERE BOMsub.boms_no = item.ITEM_NO) b ON a.母件品號 = b.母件品號) b ON  a.品號 = b.CCS AND a.子件品號 = b.子件品號
Orders_Over_Detail_Customer=SELECT DISTINCT item.pline_no AS 產線代號, cust.custnm2 AS 客戶簡稱, mkordsub.item_no AS CCS, mkordsub.lot_no AS 製造批號, cordsub.sclose AS 訂單狀況 , EMPLOY.Name 業務員, DATE_FORMAT(cordsub.d_date, '%Y/%m/%d') 預交日,date_format(mkordsub.str_date, '%Y/%m/%d') AS 預計開工日, itemios.trn_date AS 入庫日,INVOSUB.TRN_DATE 出貨日,cordsub.quantity AS 數量,cordsub.amount 金額 FROM cordsub AS cordsub LEFT JOIN item ON cordsub.ITEM_NO = item.ITEM_NO LEFT JOIN ws ON cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn LEFT JOIN mkordsub AS mkordsub ON cordsub.trn_no = mkordsub.cord_no AND cordsub.sn = mkordsub.cord_sn LEFT JOIN cust AS cust ON cust.cust_no = cordsub.cust_no LEFT JOIN cord AS cord ON cord.trn_no = cordsub.trn_no LEFT JOIN INVOSUB ON cordsub.TRN_NO=INVOSUB.CORD_NO AND cordsub.SN=INVOSUB.CORD_SN LEFT JOIN EMPLOY ON EMPLOY.EMP_NO = CORD.USER_CODE LEFT JOIN( SELECT itemios.cord_no,itemios.cord_sn,date_format(itemios.trn_date,'%Y%m%d')as trn_date,itemios.iotype FROM erp.itemios WHERE  itemios.iotype = '3' AND itemios.s_desc <> '歸還' ) AS itemios ON itemios.cord_no = cordsub.trn_no AND itemios.cord_sn = cordsub.sn WHERE item.pline_no > 0 AND DATE_FORMAT(cordsub.d_date, '%Y%m%d') <{0} AND (cordsub.sclose <> '結案' OR DATE_FORMAT(INVOSUB.TRN_DATE, '%Y%m%d') >= {0}) AND cordsub.amount > 0 {1}
Waitingfortheproduction_BigDisc=SELECT cust.custnm2 AS 客戶簡稱, ws.PLINE_NO AS 產線代號, ws.pline_no AS 工作站編號,ws.lot_no AS 排程編號, ws.cord_no AS 訂單號碼, cord.cord_no AS 客戶訂單, mkordsub.item_no AS 品號,DATE_FORMAT(cordsub.trn_date, '%Y%m%d') AS 訂單日期, DATE_FORMAT(mkordsub.str_date, '%Y%m%d') AS 預計開工日 FROM ws RIGHT JOIN mkordsub ON (ws.cord_no = mkordsub.cord_no AND ws.cord_sn = mkordsub.cord_sn AND (ws.lot_no = mkordsub.lot_no || ws.lot_no IS NULL || ws.lot_no = '')) LEFT JOIN item ON (mkordsub.item_no = item.item_no) LEFT JOIN cord ON (ws.cord_no = cord.trn_no) LEFT JOIN cordsub ON (ws.cord_no = cordsub.trn_no AND ws.cord_sn = cordsub.sn) LEFT JOIN invosub ON (ws.cord_no = invosub.cord_no AND ws.cord_sn = invosub.cord_sn AND ws.lot_no = invosub.lot_no) LEFT JOIN citem ON (citem.cust_no = mkordsub.cust_no AND citem.item_no = mkordsub.item_no) LEFT JOIN mkord ON (mkord.trn_no = mkordsub.trn_no) LEFT JOIN cust ON (cust.cust_no = mkord.cust_no) WHERE 1 = 1 AND ws.lot_no IS NOT NULL AND LENGTH(ws.lot_no) > 0 AND mkordsub.fclose IS NULL AND DATE_FORMAT(mkordsub.str_date, '%Y%m%d') <= {1} AND DATE_FORMAT(mkordsub.str_date, '%Y%m%d') >= {0} AND ws.PLINE_NO <>''
[Parameter]
Over_Detail_Customer=AND cust.custnm2='{0}'
Orders_Finished= AND cordsub.sclose  = '結案' 
Orders_Unfinished=AND cordsub.sclose  <> '結案' 
Orders_Scheduled=AND cordsub.sclose  <> '結案'   AND ( cordsub.trn_no + cordsub.sn ) IN (SELECT  ws.cord_no + ws.cord_sn FROM   ws AS ws WHERE cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn)  
Orders_Unscheduled=AND cordsub.sclose  <> '結案' AND ( cordsub.trn_no + cordsub.sn ) NOT IN (SELECT  ws.cord_no + ws.cord_sn FROM   ws AS ws WHERE cordsub.trn_no = ws.cord_no AND cordsub.sn = ws.cord_sn)   
Orders_Stock= AND cordsub.sclose  <> '結案'  and mkordsub.sclose = '結案'
Orders_Unstock= AND cordsub.sclose  <> '結案'   and mkordsub.sclose <> '結案'
UntradedCustomer_Time=and DATE_FORMAT( 最後交易日 , "%Y%m%d" ) >= {0} and DATE_FORMAT( 最後交易日 , "%Y%m%d" ) <= {1} 
materialrequirementplanning_Name= AND item.ITEMNM like '%{0}%'
materialrequirementplanning_item= AND ITEMIOS.ITEM_NO like '%{0}%'
materialrequirementplanning_dtl = AND ITEMIOS.ITEM_NO = '{0}' 
Total_warehouse= ITEM_GD.GDNO
Total_type= ITEM.CLASS
class_name= ITEM.CLASS
InactiveInventory_warehouse=ITEM_GD.GDNO
Scrapped_personnel= ITEMIO.STOCKNAME
lot_no= itemio.LOT_NO
mkord_no= itemio.mkord_no
Transport= INVOSUB.ITEM_NO
supplier_no=  AND urge_item.FACT_NO = '{0}' 
supplier_name=  AND fact.FACTNM2 like '%{0}%' 
item_no=    AND urge_item.item_no  LIKE '%{0}%' 
SupplierShortage_date=  AND date_format(urge_item.D_DATE, '%Y%m%d')>={0} AND date_format(urge_item.D_DATE, '%Y%m%d') <={1}
SupplierShortage_Column= 交易日期
in_house= LEFT JOIN( SELECT itemios.cord_no,itemios.cord_sn,date_format(itemios.trn_date,'%Y%m%d')as trn_date,itemios.iotype FROM erp.itemios WHERE  itemios.iotype = '3' AND (itemios.s_desc is null OR itemios.s_desc <>'歸還')) AS itemios ON itemios.cord_no = cordsub.trn_no AND itemios.cord_sn = cordsub.sn
in_house_column= itemios.trn_date 入庫日,
[Get_Item]
InactiveInventory_House=SELECT distinct GDNO as 儲位 FROM ITEM_GD
InactiveInventory_Class=SELECT CLASS_NO,CLASS_NAME FROM CLASS
Scrapped_Man=SELECT DISTINCT itemio.stockname AS 報廢人 FROM   item AS ITEM LEFT JOIN itemios AS ITEMIOS ON item.item_no = itemios.item_no  AND itemios.iotype = '7'  LEFT JOIN itemio AS ITEMIO  ON itemios.trn_no = itemio.trn_no  WHERE  itemios.QTY2 <> 0        AND itemios.wastes_sw2 = 'Y'  AND  date_format(itemios.trn_date, '%Y%m%d') >= {0}  AND  date_format(itemios.trn_date, '%Y%m%d')<= {1}  AND itemio.stockname is not null
Item_No=MR4A-00ZZA08,MR5D-00ZZA06,MC4A-00MMA04,MC5A-00ZZB05,MC4BQ-0MMB04,MR4CM00ZZC07
MaxOrder= select max( TRN_NO)  催料表日期 from urge_item
Shortage= select substring(max( TRN_NO),1,8)   繳交日期 from urge_item

[db_name]
inikey=erp
[J8SAw9FlExc+ZK0MfImpTg==]
inikey1=mXkIMQ5rxo+yvZc6qnYvZA==
inikey=J8SAw9FlExc+ZK0MfImpTg==
inikey2=goXv7hrBEr8j18YAGZRW6Q==
inikey3=dIZ2LilEIp+3cGMJcgZLeA==
inikey4=RMi812CkFupnl5KDLbPNEw==

